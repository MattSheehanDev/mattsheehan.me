<!doctype html>
<html lang="en">

<head>
    <title>Note on Jekyll Plugins</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
    <meta name="description" content="The spiritual home of Matt Sheehan" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0" >

    <!-- microsoft metro tags -->
    <meta name="application-name" content="Matt Sheehan" />
    <meta name="msapplication-config" content="/ietemplates/ieconfig.xml" />
    <meta name="msapplication-tooltip" content="Matt Sheehan" />
    <meta name="msapplication-navbutton-color" content="#27ae60" />

    <!--microsoft taskbar jump list tags -->
    <meta name="msapplication-task" content="name=Home; action-uri=http://mattsheehan.me/; icon-uri=http://mattsheehan.me/assets/images/favicon.ico" />
    <meta name="msapplication-task" content="name=Resume; action-uri=http://resume.mattsheehan.me; icon-uri=http://mattsheehan.me/assets/images/favicon.ico" />
    <meta name="msapplication-task" content="name=About; action-uri=http://mattsheehan.me/about/; icon-uri=http://mattsheehan.me/assets/images/favicon.ico" />

    <!-- favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico" />

    <!-- apple tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/apple/apple-touch-ipad2.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple/apple-touch-ipad.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple/apple-touch-iphone.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/assets/images/apple/apple-touch-ipadpro.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple/apple-touch-iphoneplus.png" />


    <!-- apple splashscreen -->

    <!-- iPad retina portrait -->
    <link href="/assets/images/apple/ipad/apple-touch-startup-1536x2048.png"
    media="(device-width: 768px)
            and (device-height: 1024px)
            and (-webkit-device-pixel-ratio: 2)
            and (orientation: portrait)"
    rel="apple-touch-startup-image" />
    <!-- iPad retina landscape -->
    <link href="/assets/images/apple/ipad/apple-touch-startup-2048x1536.png"
    media="(device-width: 768px)
            and (device-height: 1024px)
            and (-webkit-device-pixel-ratio: 2)
            and (orientation: landscape)"
    rel="apple-touch-startup-image" />
    <!-- iPad non-retina portrait -->
    <link href="/assets/images/apple/ipad2/apple-touch-startup-768x1024.png"
    media="(device-width: 768px)
            and (device-height: 1024px)
            and (-webkit-device-pixel-ratio: 1)
            and (orientation: portrait)"
    rel="apple-touch-startup-image" />
    <!-- iPad non-retina landscape -->
    <link href="/assets/images/apple/ipad2/apple-touch-startup-1024x768.png"
    media="(device-width: 768px)
            and (device-height: 1024px)
            and (-webkit-device-pixel-ratio: 1)
            and (orientation: landscape)"
    rel="apple-touch-startup-image" />
    <!-- iPhone 6 plus portrait -->
    <link href="/assets/images/apple/iphone6plus/apple-touch-startup-1242x2208.png"
    media="(device-width: 414px)
            and (device-height: 736px)
            and (-webkit-device-pixel-ratio: 3)
            and (orientation: portrait)"
    rel="apple-touch-startup-image" />
    <!-- iPhone 6 plus landscape -->
    <link href="/assets/images/apple/iphone6plus/apple-touch-startup-2208x1242.png"
    media="(device-width: 414px)
            and (device-height: 736px)
            and (-webkit-device-pixel-ratio: 3)
            and (orientation: landscape)"
    rel="apple-touch-startup-image" />
    <!-- iPhone 6 portrait -->
    <link href="/assets/images/apple/iphone6/apple-touch-startup-750x1334.png"
    media="(device-width: 375px)
            and (device-height: 667px)
            and (-webkit-device-pixel-ratio: 2)
            and (orientation: portrait)"
    rel="apple-touch-startup-image" />
    <!-- iPhone 6 landscape -->
    <link href="/assets/images/apple/iphone6/apple-touch-startup-1334x750.png"
    media="(device-width: 375px)
            and (device-height: 667px)
            and (-webkit-device-pixel-ratio: 2)
            and (orientation: landscape)"
    rel="apple-touch-startup-image" />
    <!-- iPhone 5 portrait -->
    <link href="/assets/images/apple/iphone5/apple-touch-startup-640x1136.png"
    media="(device-width: 320px)
            and (device-height: 568px)
            and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image" />
    <!-- iPhone < 5 retina portrait -->
    <link href="/assets/images/apple/iphone/apple-touch-startup-640x920.png"
    media="(device-width: 320px)
            and (device-height: 480px)
           and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image" />
    <!-- iPhone < 5 non-retina portrait -->
    <link href="/assets/images/apple/iphone/apple-touch-startup-320x640.png"
    media="(device-width: 320px)
            and (device-height: 480px)
            and (-webkit-device-pixel-ratio: 1)"
    rel="apple-touch-startup-image" />


    <!-- site links -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/fonts.css" />
</head>


<body>


	<svg display=none>
  <defs>
    <path id=icon-twitter-bird d="M34.7 5c1.7-1 2.8-2.5 3.4-4.4-1.6 0.9-3.3 1.6-5 2-1.6-1.7-3.6-2.6-5.8-2.6-2.2 0-4.2 0.7-5.7 2.3-1.6 1.6-2.3 3.4-2.3 5.8 0 0.6 0.1 1.2 0.2 1.8-6.9-0.4-12.6-3.2-16.9-8.5-0.7 1.2-1.1 2.7-1.1 4.1 0 3 1.2 5.2 3.6 6.8-1.2 0-2.5-0.4-3.6-1v0.1c0 2 0.6 3.7 1.8 5.2 1.2 1.5 2.7 2.5 4.6 2.8-0.6 0.1-1.2 0.2-2.1 0.2-0.4 0-0.9 0-1.5-0.1 0.5 1.5 1.4 2.8 2.8 3.8 1.4 1 3 1.5 4.7 1.6-3.1 2.5-6.4 3.7-10 3.7-0.5 0-1.1 0-2-0.1 3.7 2.2 7.8 3.4 12.4 3.4 3.6 0 6.8-0.7 9.8-2.1 3-1.4 5.4-3.2 7.3-5.4 1.8-2.2 3.3-4.7 4.3-7.4s1.6-5.4 1.6-8.1v-1c1.4-1 2.7-2.5 3.9-4.2-1.6 0.6-3.2 1.1-4.7 1.2z"></path>
    <path id=icon-rss d="M16 0q6.6 0 11.3 4.7t4.7 11.3q0 6.6-4.7 11.3t-11.3 4.7-11.3-4.7-4.7-11.3 4.7-11.3 11.3-4.7zM10.7 24q1.1 0 1.9-0.8t0.8-1.9-0.8-1.9-1.9-0.8-1.9 0.8-0.8 1.9 0.8 1.9 1.9 0.8zM16.7 24h3.3q0-5-3.5-8.5t-8.5-3.5v3.3q3.6 0 6.1 2.5t2.5 6.1zM22.7 24h3.3q0-3.7-1.4-7t-3.8-5.7-5.7-3.8-7-1.4v3.3q6.1 0 10.4 4.3t4.3 10.4z"></path>
    <path id=icon-twitter d="M16 0q6.6 0 11.3 4.7t4.7 11.3-4.7 11.3-11.3 4.7-11.3-4.7-4.7-11.3 4.7-11.3 11.3-4.7zM25.7 12.5q1.2-0.9 2.3-2.3-1.3 0.6-2.6 0.7 1.4-0.8 2-2.5-1.4 0.8-2.9 1.1-1.3-1.4-3.3-1.4-1.9 0-3.2 1.3t-1.3 3.2q0 0.6 0.1 1-5.7-0.3-9.4-4.8-0.6 1.1-0.6 2.3 0 2.4 2 3.8-1 0-2-0.6v0q0 1.6 1 2.9t2.6 1.6q-0.5 0.1-1.2 0.1-0.3 0-0.9-0.1 0.4 1.4 1.6 2.2t2.6 0.9q-2.6 2.1-5.6 2.1-0.4 0-1.1-0.1 3.1 2 7 2 3 0 5.5-1.2t4.1-3.1 2.4-4.1 0.9-4.6v-0.6z"></path>
    <path id=icon-github d="M16 0q6.59 0 11.3 4.7t4.7 11.3q0 5.52-3.39 9.85t-8.61 5.67v-4.18q0-2.89-1.67-4.18 3.37-0.52 5.52-2.41t2.15-4.74q0-2.52-1.85-4.59 0.67-3.07-0.15-4.74-2.04 0.19-4.63 1.78-1.78-0.44-3.37-0.44t-3.37 0.44q-2.59-1.59-4.63-1.78-0.85 1.78-0.15 4.74-1.85 2.07-1.85 4.59 0 2.85 2.15 4.74t5.52 2.41q-0.85 0.63-1.3 1.82-0.67 0-1.37-0.13t-1.28-0.35-1.11-0.5-0.96-0.56-0.72-0.52-0.48-0.39l-0.15-0.15q-0.26-0.26-0.52-0.07-0.3 0.19-0.22 0.52 0.7 1.37 1.19 2 1.93 2.48 5.26 3.48v3.22q-5.22-1.33-8.61-5.67t-3.39-9.85q0-6.63 4.68-11.31t11.32-4.68z"></path>
  </defs>
</svg>

<header class="site-header">
  <div class="site-header__content">
    <div class="site-header__signature">
      <a href="/" title="Home">
        <img type="image/svg+xml" src="/assets/images/signature-green.svg" />
      </a>
      <span>Software Developer</span>
    </div>
    <a class="site-header__portrait" href="/" title="Home">
      <div>If you don't see a picture of me here, just imagine a handsome man.</div>
    </a>


    <div class="site-header__social">
      <a href="http://www.github.com/sheehamj13" target="_blank" class="social-nav__icon social-nav__icon-github" title="Github">
        <svg viewBox="0 0 32 32">
          <use xlink:href="#icon-github"></use>
        </svg>
      </a>
      <a href="/feeds/rss.xml" target="_blank" class="social-nav__icon social-nav__icon-rss" title="RSS">
        <svg viewBox="0 0 32 32">
          <use xlink:href="#icon-rss"></use>
        </svg>
      </a>
    </div>

    <div class="site-header__links">
      <a href="/" class="link" title="Journal">Journal</a>
      <a href="/archives/" class="link" title="Archive">Archive</a>
      <a href="/about" class="link" title="About">About</a>
      <!-- Resume is a seperate project -->
      <a href="http://resume.mattsheehan.me" class="link" title="Resume">Resume</a>
    </div>
  </div>
</header>

	<div class="site-content">
		

<main class="post" role="main">
    <h2 class="title">Note on Jekyll Plugins</h2>
    <span class="date">April 21, 2015</span>

    <div class="content">
        <p>There’s not a lot of really good documentation on how to roll your own <a href="http://jekyllrb.com">Jekyll</a> plugins, and most of the plugins that currently exist aren’t very good. That includes a few of my first attempts. Through some trial and error, <a href="http://stackoverflow.com">Stackoverflow</a> searching, and <a href="https://github.com/jekyll/jekyll">source code</a> browsing, I’ve managed to gather a few ‘best practices’. Especially for writing Generators, the most popular and used type.</p>

<p class="soliloquy">There are four types of <a href="http://jekyllrb.com/docs/plugins/">plugins</a>, Generators, Converters, Commands and Tags. This post is about generators<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>.</p>

<p>There are four important things you should know about generators first.</p>

<ul>
  <li>They are invoked before the site is built, but after it is initialized, and usually directly copied to the _site folder.</li>
  <li>They must inherit from Jekyll’s base Generator class.</li>
  <li>Like all other plugins, they belong in your _plugins folder.</li>
  <li>They’re often written wrong, or at least not optimal, and most of the generators you steal will clutter up your directory.</li>
</ul>

<p>Generator’s only have one important function to know which is <code class="highlight">generate</code>, and is passed one argument <code>site</code>.</p>

<pre><code>module Jekyll
    class MyGenerator &lt; Generator
        def generate(site)
            # do stuff here
        end
    end
end
</code></pre>

<p>There’s two important properties of <code>site</code> that you should learn first, those being the array <code>static_files</code> and the hash map <code>pages</code>. If you want your generator to create files that need to be converted, therefore have YAML front matter, you should add your page to <code>site.pages</code>.</p>

<pre><code>module Jekyll
    class MyGenerator &lt; Generator
        def generate(site)
            site.pages &lt;&lt; MyPage.new(site, site.source, 'some/directory', 'file.html')
        end
    end

    class MyPage &lt; Page
        def initialize(site, base, dir, name)
            super(site, base, dir, name)
        end
    end
end
</code></pre>

<p>I created a custom page class that inherits from Jekyll’s base <code>Page</code> class. That’s not necessary in this example if you’re not doing any custom page work, but that will be important later.</p>

<p>What I’m more concerned about is <code>static_files</code>. These do not have YAML front matter and do no post-processing. But the problem with static files you see, is if you create static files in your generator and add them to the sites static_files array, those files would first get created in your project directory and then copied into your site’s root folder, which is usually _site.</p>

<p>Do you see the problem? There are duplicate files being created then immediately copied and cluttering up your source directory. Since files created at build shouldn’t be added to source control you then end up ignoring those created directories and files in your .gitignore file. I know this isn’t super performant code, so it’s not really a big deal. But sometimes it’s fun to just be clever and see how much better you can do.</p>

<p>There’s actually another secret that Jekyll hides that let us take advantage of waiting to write our static files until after the site is build and therefore only write it once into your site root folder. The base <code>Page</code> class used above actually has an important method called ‘write’, which is passed a `dest’ string.</p>

<p>When write is invoked is when we should actually be writing all of our static files. So our end code would look something like below.</p>

<pre><code>    class MyGenerator &lt; Generator
        def generate(site)
            # add our pages here to static files array
            site.static_files &lt;&lt; MyPage.new(site, site.source, 'some/directory', 'file.html')
        end
    end

    class MyPage &lt; StaticFile
        def initialize(site, base, dir, name)
            super(site, base, dir, name)
        end

        def write(dest)
            # write is called after _site directory is built
            # lets write our static files once here
            path = File.join(dest, base, @dir)
            FileUtils.mkdir_p(path)

            # build up your file...
            ...

            # write file
            File.open(File.join(path, @name), 'w') { |f| f.write(file) }
        end
    end
</code></pre>

<p>The secret is overloading the pages write method, which is usually invoked to just copy static files<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>.</p>

<p class="soliloquy">You should also notice that MyPage is inheriting from StaticFile this time instead of Page. And remember to put your class’s under the Jekyll namespace.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>This is probably the first post I’ve written in two years with any meat on it. Not good meat mind you, think more pink slime. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><del>I should link these notes in the post.</del> Done. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

    <div class="post-nav">
      
        <div class="post-nav__previous">
          <div>Previous</div>
          <a href="/archives/site-updates-again/" title="Site Updates (again)">Site Updates (again)</a>
        </div>
      
      
        <div class="post-nav__next">
          <div>Next</div>
          <a href="/archives/billy-joel/" title="Leave a Tender Moment Alone">Leave a Tender Moment Alone</a>
        </div>
      
    </div>
</main>


<footer class="post-footer">
  <div class="post-footer__content">
    <h6 class="author">Written and Published by Matt Sheehan</h6>
    <div class="quip row">
        <div>Fast learner, amateur coffee drinker, good guy, programmer.</div>
        <div>Mostly in that order.</div>
    </div>
  </div>
</footer>

	</div>

</body>

</html>
